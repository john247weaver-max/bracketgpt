<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover" />
  <title>BracketGPT</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --navy: #0b1c3d;
      --orange: #f37021;
      --white: #ffffff;
      --red: #e10600;
      --gold: #ffc72c;
      --panel: #112752;
      --panel-border: rgba(255, 255, 255, 0.14);
      --muted: #aab7d6;
      --text-shadow: 0 2px 12px rgba(0, 0, 0, 0.4);
      --radius: 16px;
    }

    html, body { height: 100%; }

    body {
      overflow: hidden;
      font-family: 'Inter', system-ui, sans-serif;
      color: var(--white);
      background:
        linear-gradient(145deg, rgba(11, 28, 61, 0.86), rgba(6, 15, 34, 0.94)),
        radial-gradient(circle at 18% 20%, rgba(243, 112, 33, 0.2), transparent 35%),
        radial-gradient(circle at 80% 10%, rgba(255, 199, 44, 0.1), transparent 40%),
        var(--navy);
      -webkit-font-smoothing: antialiased;
    }

    .app {
      display: flex;
      flex-direction: column;
      height: 100%;
      max-width: 980px;
      margin: 0 auto;
      animation: fade-in .55s ease;
    }

    .hdr {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 20px;
      border-bottom: 1px solid var(--panel-border);
      background: rgba(8, 20, 45, 0.82);
      backdrop-filter: blur(10px);
      flex-shrink: 0;
    }

    .logo {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      background: linear-gradient(135deg, var(--orange), #cf510b);
      box-shadow: 0 0 20px rgba(243, 112, 33, 0.5);
      font-size: 20px;
    }

    .hdr h1, .hero h2 {
      font-family: 'Anton', Impact, sans-serif;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      text-shadow: var(--text-shadow);
      line-height: 1;
    }

    .hdr h1 { font-size: 20px; }
    .sub { font-size: 11px; letter-spacing: .08em; text-transform: uppercase; color: var(--muted); margin-top: 3px; }

    .live {
      margin-left: auto;
      border: 1px solid rgba(255, 199, 44, 0.45);
      color: var(--gold);
      border-radius: 999px;
      padding: 4px 12px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .08em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(255, 199, 44, 0.08);
    }

    .live::before {
      content: '';
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--gold);
      animation: pulse 1.5s ease infinite;
    }

    .msgs {
      flex: 1 1 0;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .hero {
      min-height: calc(100vh - 190px);
      display: grid;
      place-items: center;
      text-align: center;
      border: 1px solid var(--panel-border);
      border-radius: 24px;
      padding: 42px 24px;
      background:
        linear-gradient(180deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01)),
        linear-gradient(160deg, rgba(243, 112, 33, 0.12), rgba(11, 28, 61, 0.12));
      box-shadow: inset 0 0 80px rgba(0, 0, 0, 0.3), 0 14px 40px rgba(0, 0, 0, 0.35);
    }

    .hero h2 { font-size: clamp(44px, 11vw, 110px); }
    .hero .kicker { color: var(--gold); font-weight: 700; letter-spacing: .16em; text-transform: uppercase; font-size: 12px; margin-bottom: 12px; }
    .hero .tagline { margin-top: 12px; font-size: clamp(20px, 2.5vw, 30px); font-weight: 800; letter-spacing: .03em; text-transform: uppercase; }
    .hero p { color: var(--muted); margin: 12px auto 28px; max-width: 600px; }

    .cta { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; }

    .cta-btn, .quick button, .snd {
      border: none;
      color: var(--white);
      background: linear-gradient(135deg, var(--orange), #cb4f0f);
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .05em;
      transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
      box-shadow: 0 0 18px rgba(243, 112, 33, 0.35);
    }

    .cta-btn { padding: 14px 20px; font-size: 13px; }
    .cta-btn:hover, .quick button:hover, .snd:hover { transform: scale(1.05); filter: brightness(1.05); box-shadow: 0 0 26px rgba(243, 112, 33, 0.48); }

    .quick {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .quick button {
      padding: 10px 13px;
      font-size: 11px;
      background: rgba(243, 112, 33, 0.16);
      border: 1px solid rgba(243, 112, 33, 0.45);
    }

    .hypo {
      margin-top: 14px;
      display: grid;
      grid-template-columns: 1fr auto 1fr auto;
      gap: 8px;
      align-items: center;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .hypo input {
      padding: 10px 11px;
      border-radius: 10px;
      border: 1px solid var(--panel-border);
      background: rgba(17, 39, 82, .95);
      color: var(--white);
      outline: none;
      min-width: 0;
    }

    .hypo .vs-text { color: var(--muted); font-size: 12px; font-weight: 700; letter-spacing: .08em; }
    .hypo button { padding: 10px 12px; font-size: 11px; }

    .m { display: flex; gap: 10px; max-width: 92%; animation: rise .3s ease; }
    .m.u { margin-left: auto; flex-direction: row-reverse; }
    .av { width: 30px; height: 30px; border-radius: 9px; display: grid; place-items: center; font-size: 14px; flex-shrink: 0; margin-top: 3px; }
    .m.b .av { background: linear-gradient(135deg, var(--orange), #cc520f); }
    .m.u .av { background: #24467f; }
    .bd { padding: 12px 14px; border-radius: var(--radius); border: 1px solid var(--panel-border); background: rgba(17, 39, 82, 0.9); font-size: 14px; line-height: 1.55; }
    .m.u .bd { background: rgba(243, 112, 33, 0.17); border-color: rgba(243, 112, 33, 0.45); }

    .scoreboard {
      margin: 10px 0;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 14px;
      background: linear-gradient(160deg, rgba(255, 255, 255, 0.04), rgba(0, 0, 0, 0.14));
      overflow: hidden;
    }

    .teams { display: grid; grid-template-columns: 1fr auto 1fr; align-items: stretch; }
    .team { padding: 12px; text-align: center; }
    .team .name { font-weight: 700; letter-spacing: .04em; text-transform: uppercase; font-size: 12px; }
    .team .score { font-family: 'Anton', sans-serif; font-size: 44px; line-height: .95; margin-top: 4px; }
    .winner { color: var(--gold); text-shadow: 0 0 16px rgba(255, 199, 44, .55); animation: winner-glow 2s ease infinite; }
    .vs { padding: 14px 8px; display: grid; place-items: center; color: var(--muted); font-size: 12px; font-weight: 700; letter-spacing: .08em; }

    .metrics { border-top: 1px solid rgba(255,255,255,.14); padding: 10px 12px 12px; }
    .bar-head { display: flex; justify-content: space-between; align-items: center; font-size: 11px; text-transform: uppercase; letter-spacing: .06em; color: var(--muted); }
    .bar-track { height: 8px; border-radius: 999px; background: rgba(255,255,255,.12); margin-top: 6px; overflow: hidden; }
    .bar-fill { height: 100%; width: 0; border-radius: inherit; background: linear-gradient(90deg, var(--orange), var(--gold)); transition: width 1s cubic-bezier(.22,.61,.36,1); }

    .upset {
      margin-top: 10px;
      display: inline-flex;
      gap: 6px;
      align-items: center;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(225, 6, 0, 0.18);
      color: #ff8b87;
      border: 1px solid rgba(225, 6, 0, 0.55);
      font-size: 10px;
      font-weight: 800;
      letter-spacing: .08em;
      text-transform: uppercase;
      animation: pulse 1.25s ease infinite;
    }

    .typing { display: none; gap: 10px; }
    .typing.on { display: flex; }
    .dots { display: flex; gap: 5px; border: 1px solid var(--panel-border); border-radius: 12px; background: rgba(17, 39, 82, .9); padding: 14px 12px; }
    .dots span { width: 6px; height: 6px; border-radius: 50%; background: var(--muted); animation: blink 1.4s infinite both; }
    .dots span:nth-child(2) { animation-delay: .2s; }
    .dots span:nth-child(3) { animation-delay: .4s; }

    .iw { flex-shrink: 0; padding: 12px 16px 16px; border-top: 1px solid var(--panel-border); background: rgba(6, 15, 34, 0.75); }
    .ir { display: flex; align-items: center; gap: 8px; border: 1px solid var(--panel-border); border-radius: 13px; padding: 4px 4px 4px 14px; background: rgba(17, 39, 82, .95); }
    .ir:focus-within { border-color: rgba(243, 112, 33, .62); box-shadow: 0 0 0 3px rgba(243, 112, 33, .15); }
    .ir input { flex: 1; background: none; border: none; color: var(--white); outline: none; font-size: 14px; }
    .ir input::placeholder { color: #8ca2cf; }
    .snd { width: 38px; height: 38px; display: grid; place-items: center; }
    .hint { text-align: center; margin-top: 7px; font-size: 11px; color: var(--muted); }

    @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes rise { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes blink { 0%, 80%, 100% { opacity: .35; } 40% { opacity: 1; } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .45; } }
    @keyframes winner-glow { 0%,100% { text-shadow: 0 0 12px rgba(255, 199, 44, .4); } 50% { text-shadow: 0 0 22px rgba(255, 199, 44, .75); } }

    @media (max-width: 700px) {
      .msgs { padding: 12px; }
      .hero { min-height: calc(100vh - 170px); padding: 30px 14px; }
      .hero .tagline { font-size: 19px; }
      .m { max-width: 96%; }
      .team .score { font-size: 38px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="hdr">
      <div class="logo">üèÄ</div>
      <div>
        <h1 id="an">BRACKETGPT</h1>
        <div class="sub" id="at">AI TOURNAMENT PREDICTOR</div>
      </div>
      <span class="live" id="live-tag">Live Model</span>
    </div>

    <div class="msgs" id="msgs">
      <div class="hero" id="wel">
        <div>
          <div class="kicker">Championship Intelligence</div>
          <h2 id="hero-brand">BracketGPT</h2>
          <div class="tagline" id="hero-tagline">Win Your Pool. Dominate Your Friends.</div>
          <p>Broadcast-style matchup projections, upset alerts, and bracket strategy built for March Madness chaos.</p>
          <div class="cta">
            <button class="cta-btn" onclick="go('Start my bracket strategy for this year')">Start My Bracket</button>
            <button class="cta-btn" onclick="go('Analyze a matchup: Duke vs Houston')">Analyze a Matchup</button>
            <button class="cta-btn" onclick="window.location.href='/value-picks'">Where The Public Is Wrong</button>
          </div>
          <div class="quick">
            <button onclick="go('Best upset picks this tournament?')">Upset Radar</button>
            <button onclick="go('Which 12-seed has the best shot?')">12-seed dark horse</button>
            <button onclick="go('Compare top 1-seeds')">Compare 1-seeds</button>
            <button onclick="go('Build a contrarian Final Four')">Contrarian Final Four</button>
            <button onclick="go('Compare any two teams')">Compare any two teams</button>
          </div>
          <div class="hypo">
            <input id="hypo-a" type="text" placeholder="Team A (e.g., Florida)" />
            <span class="vs-text">VS</span>
            <input id="hypo-b" type="text" placeholder="Team B (e.g., Auburn)" />
            <button class="cta-btn" onclick="runHypo()">Hypothetical Matchup</button>
          </div>
        </div>
      </div>

      <div class="typing" id="typ">
        <div class="av" style="background:linear-gradient(135deg,var(--orange),#cc520f)">üèÄ</div>
        <div class="dots"><span></span><span></span><span></span></div>
      </div>
    </div>

    <div class="iw">
      <div class="ir">
        <input type="text" id="inp" placeholder="Ask about any matchup‚Ä¶" autocomplete="off" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();go()}" />
        <button class="snd" id="btn" onclick="go()" aria-label="Send prompt">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        </button>
      </div>
      <div class="hint">Tournament simulation engine ¬∑ upset detection live</div>
    </div>
  </div>

  <script>
    const $ = (s) => document.getElementById(s);
    const msgs = $('msgs');
    const inp = $('inp');
    const btn = $('btn');
    const typ = $('typ');
    let hist = [];
    let busy = false;

    (async () => {
      try {
        const r = await fetch('/api/config');
        if (r.ok) {
          const c = await r.json();
          if (c.brandName) {
            $('an').textContent = c.brandName.toUpperCase();
            $('hero-brand').textContent = c.brandName;
            document.title = c.brandName;
          }
          if (c.tagline) {
            $('at').textContent = c.tagline.toUpperCase();
            $('hero-tagline').textContent = c.tagline;
          }
          if (c.activeSeason) $('live-tag').textContent = `Season ${c.activeSeason}`;
        }
      } catch (e) {}
    })();

    inp.addEventListener('input', () => btn.classList.toggle('on', inp.value.trim().length > 0));

    function scroll() { msgs.scrollTop = msgs.scrollHeight; }

    function esc(t) {
      const d = document.createElement('div');
      d.textContent = t;
      return d.innerHTML;
    }

    function parseMatchupCard(text) {
      const scoreMatch = text.match(/(?:projected\s+score|score)\s*[:\-]\s*([A-Za-z .'-]+)\s*(\d{2,3})\s*[,\-]\s*([A-Za-z .'-]+)\s*(\d{2,3})/i);
      const winMatch = text.match(/win\s+prob(?:ability)?\s*[:\-]\s*([A-Za-z .'-]+)?\s*(\d{1,3})%/i);
      const upsetMatch = text.match(/upset\s+prob(?:ability)?\s*[:\-]\s*(\d{1,3})%/i);
      if (!scoreMatch || !winMatch) return '';

      const teamA = scoreMatch[1].trim();
      const scoreA = Number(scoreMatch[2]);
      const teamB = scoreMatch[3].trim();
      const scoreB = Number(scoreMatch[4]);
      const winner = scoreA >= scoreB ? teamA : teamB;
      const winPct = Math.max(0, Math.min(100, Number(winMatch[2])));
      const upsetPct = upsetMatch ? Number(upsetMatch[1]) : 0;

      return `<div class="scoreboard">
        <div class="teams">
          <div class="team ${winner === teamA ? 'winner' : ''}">
            <div class="name">${esc(teamA)}</div>
            <div class="score" data-score="${scoreA}">0</div>
          </div>
          <div class="vs">VS</div>
          <div class="team ${winner === teamB ? 'winner' : ''}">
            <div class="name">${esc(teamB)}</div>
            <div class="score" data-score="${scoreB}">0</div>
          </div>
        </div>
        <div class="metrics">
          <div class="bar-head"><span>${esc(winner)} win probability</span><span>${winPct}%</span></div>
          <div class="bar-track"><div class="bar-fill" data-width="${winPct}"></div></div>
          ${upsetPct > 30 ? `<div class="upset">üî• Upset Alert ${upsetPct}%</div>` : ''}
        </div>
      </div>`;
    }

    function fmt(t) {
      const card = parseMatchupCard(t);
      let s = t
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/`([^`]+)`/g, '<code style="background:rgba(255,255,255,.12);padding:1px 5px;border-radius:4px;font-size:12px">$1</code>');

      const blocks = s.split(/\n{2,}/);
      let h = card;
      for (const b of blocks) {
        const tr = b.trim();
        if (!tr) continue;
        const lines = tr.split('\n');
        const isList = lines.length > 1 && lines.filter(l => l.trim()).every(l => /^\s*[-*]\s|^\s*\d+[.)]\s/.test(l));
        if (isList) {
          h += '<ul style="margin:8px 0 8px 18px">' + lines.filter(l => l.trim()).map(l => `<li>${l.replace(/^\s*[-*]\s*/, '').replace(/^\s*\d+[.)]\s*/, '')}</li>`).join('') + '</ul>';
        } else {
          h += `<p style="margin:0 0 8px">${tr.replace(/\n/g, '<br>')}</p>`;
        }
      }
      return h || `<p>${s}</p>`;
    }

    function animateMessage(el) {
      el.querySelectorAll('.bar-fill').forEach((bar) => {
        requestAnimationFrame(() => { bar.style.width = `${bar.dataset.width}%`; });
      });
      el.querySelectorAll('.score[data-score]').forEach((scoreEl) => {
        const target = Number(scoreEl.dataset.score);
        const start = performance.now();
        const duration = 900;
        const tick = (now) => {
          const p = Math.min(1, (now - start) / duration);
          scoreEl.textContent = Math.round(target * p);
          if (p < 1) requestAnimationFrame(tick);
        };
        requestAnimationFrame(tick);
      });
    }

    function add(w, t) {
      const e = $('wel');
      if (e) e.remove();
      const d = document.createElement('div');
      d.className = `m ${w === 'u' ? 'u' : 'b'}`;
      d.innerHTML = `<div class="av">${w === 'u' ? 'üë§' : 'üèÄ'}</div><div class="bd">${w === 'u' ? esc(t) : fmt(t)}</div>`;
      msgs.insertBefore(d, typ);
      animateMessage(d);
      scroll();
      return d;
    }

    function runHypo() {
      const a = document.getElementById('hypo-a')?.value?.trim();
      const b = document.getElementById('hypo-b')?.value?.trim();
      if (!a || !b) return;
      go(`Who would win if ${a} played ${b}?`);
    }

    async function go(text) {
      const msg = text || inp.value.trim();
      if (!msg || busy) return;
      inp.value = '';
      btn.classList.remove('on');
      busy = true;
      hist.push({ role: 'user', content: msg });
      add('u', msg);
      typ.classList.add('on');
      scroll();

      try {
        const r = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ messages: hist })
        });
        const d = await r.json();
        typ.classList.remove('on');
        const reply = d.reply || d.error || 'Something went wrong.';
        hist.push({ role: 'assistant', content: reply });
        add('b', reply);
      } catch (e) {
        typ.classList.remove('on');
        add('b', 'Lost connection ‚Äî try again.');
      }
      busy = false;
      inp.focus();
    }
  </script>
</body>
</html>
