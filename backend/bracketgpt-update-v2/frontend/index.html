<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<title>BracketGPT</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet">
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  :root{
    --bg:#0D1117;--surface:#161B22;--card:#1C2128;--elevated:#252C35;
    --border:rgba(139,148,158,.12);--border-focus:rgba(56,189,248,.3);
    --text:#E6EDF3;--text2:#8B949E;--muted:#484F58;
    --green:#3FB950;--green-s:rgba(63,185,80,.12);
    --blue:#58A6FF;--orange:#F0883E;--red:#F85149;--purple:#BC8CFF;
    --user-bg:#1A3A2A;
    --r:14px;
  }
  html{height:100%}
  body{
    height:100%;overflow:hidden;
    font-family:'DM Sans',-apple-system,BlinkMacSystemFont,sans-serif;
    background:var(--bg);color:var(--text);
    -webkit-font-smoothing:antialiased;
  }

  /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
  .app{display:flex;flex-direction:column;height:100%;max-width:780px;margin:0 auto}

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  .hdr{
    display:flex;align-items:center;gap:11px;
    padding:12px 18px;
    background:var(--surface);border-bottom:1px solid var(--border);
    flex-shrink:0;z-index:5;
  }
  .hdr-icon{
    width:34px;height:34px;border-radius:10px;
    background:linear-gradient(135deg,var(--green),#238636);
    display:flex;align-items:center;justify-content:center;font-size:16px;
    box-shadow:0 0 16px rgba(63,185,80,.12);flex-shrink:0;
  }
  .hdr h1{font-size:15px;font-weight:700;letter-spacing:-.02em;line-height:1}
  .hdr .sub{font-size:10.5px;font-weight:500;color:var(--text2);margin-top:2px}
  .hdr .live{
    margin-left:auto;padding:3px 9px;border-radius:20px;
    background:var(--green-s);color:var(--green);
    font-size:10px;font-weight:600;letter-spacing:.04em;
    display:flex;align-items:center;gap:5px;
  }
  .hdr .live::before{content:'';width:5px;height:5px;border-radius:50%;background:var(--green);animation:pulse 2s ease infinite}

  /* ‚îÄ‚îÄ MESSAGES ‚îÄ‚îÄ */
  .msgs{
    flex:1 1 0;
    overflow-y:auto;overflow-x:hidden;
    -webkit-overflow-scrolling:touch;
    padding:16px 14px;
    display:flex;flex-direction:column;
  }
  .msgs::-webkit-scrollbar{width:4px}
  .msgs::-webkit-scrollbar-thumb{background:var(--muted);border-radius:2px}

  /* spacer pushes content up when few msgs */
  .msgs-spacer{flex:1 1 auto;min-height:0}
  /* bottom pad so input doesn't cover last msg */
  .msgs-pad{flex-shrink:0;height:80px}

  /* ‚îÄ‚îÄ WELCOME ‚îÄ‚îÄ */
  .welcome{
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    flex:1;padding:20px;text-align:center;
    animation:fadeUp .5s ease;
  }
  .welcome .ico{
    width:60px;height:60px;border-radius:18px;
    background:linear-gradient(145deg,var(--green),#238636);
    display:flex;align-items:center;justify-content:center;
    font-size:28px;margin-bottom:16px;
    box-shadow:0 6px 28px rgba(63,185,80,.16);
  }
  .welcome h2{font-size:21px;font-weight:700;letter-spacing:-.03em;margin-bottom:5px}
  .welcome p{font-size:13px;color:var(--text2);max-width:330px;line-height:1.5;margin-bottom:22px}
  .prompts{display:flex;flex-wrap:wrap;gap:7px;justify-content:center;max-width:460px}
  .prompts button{
    padding:8px 13px;border-radius:9px;
    background:var(--card);border:1px solid var(--border);
    color:var(--text2);font-size:12px;font-weight:500;font-family:inherit;
    cursor:pointer;transition:all .15s;
  }
  .prompts button:hover{background:var(--elevated);color:var(--text);border-color:var(--border-focus);transform:translateY(-1px)}

  /* ‚îÄ‚îÄ BUBBLES ‚îÄ‚îÄ */
  .m{display:flex;gap:9px;max-width:88%;margin-bottom:12px;animation:msgIn .3s ease}
  .m.u{margin-left:auto;flex-direction:row-reverse}
  .m .av{
    width:26px;height:26px;border-radius:8px;
    display:flex;align-items:center;justify-content:center;
    font-size:12px;flex-shrink:0;margin-top:2px;
  }
  .m.b .av{background:linear-gradient(135deg,var(--green),#238636)}
  .m.u .av{background:var(--elevated)}
  .m .bd{
    padding:10px 14px;border-radius:var(--r);
    font-size:13.5px;line-height:1.55;letter-spacing:-.005em;
    word-wrap:break-word;overflow-wrap:break-word;
  }
  .m.u .bd{background:var(--user-bg);border:1px solid rgba(63,185,80,.12);border-bottom-right-radius:4px}
  .m.b .bd{background:var(--card);border:1px solid var(--border);border-bottom-left-radius:4px}

  /* Bot text formatting */
  .m.b .bd p{margin-bottom:8px}
  .m.b .bd p:last-child{margin-bottom:0}
  .m.b .bd strong{color:var(--green);font-weight:600}
  .m.b .bd em{color:var(--blue);font-style:normal;font-weight:500}
  .m.b .bd ul,.m.b .bd ol{margin:6px 0 8px 18px;font-size:13px}
  .m.b .bd li{margin-bottom:3px}
  .m.b .bd hr{border:none;border-top:1px solid var(--border);margin:10px 0}

  /* badges */
  .badge{
    display:inline-block;padding:2px 7px;border-radius:5px;
    font-size:10px;font-weight:600;letter-spacing:.03em;
    text-transform:uppercase;vertical-align:middle;
  }
  .badge-lock{background:rgba(63,185,80,.15);color:var(--green)}
  .badge-confident{background:rgba(88,166,255,.12);color:var(--blue)}
  .badge-lean{background:rgba(240,136,62,.12);color:var(--orange)}
  .badge-slight{background:rgba(188,140,255,.12);color:var(--purple)}
  .badge-tossup{background:rgba(248,81,73,.12);color:var(--red)}

  /* typing */
  .typing{display:none;gap:9px;max-width:88%;margin-bottom:12px}
  .typing.on{display:flex}
  .dots{
    display:flex;gap:4px;padding:14px;
    background:var(--card);border-radius:var(--r);border:1px solid var(--border);
    border-bottom-left-radius:4px;
  }
  .dots span{width:6px;height:6px;border-radius:50%;background:var(--muted);animation:blink 1.4s infinite both}
  .dots span:nth-child(2){animation-delay:.2s}
  .dots span:nth-child(3){animation-delay:.4s}

  /* ‚îÄ‚îÄ INPUT ‚îÄ‚îÄ */
  .input-wrap{
    flex-shrink:0;
    padding:10px 14px 16px;
    background:var(--bg);
    border-top:1px solid var(--border);
  }
  .input-row{
    display:flex;align-items:center;gap:7px;
    background:var(--surface);border:1px solid var(--border);
    border-radius:12px;padding:4px 4px 4px 14px;
    transition:border-color .2s;
  }
  .input-row:focus-within{border-color:var(--border-focus);box-shadow:0 0 0 3px rgba(56,189,248,.05)}
  .input-row input{
    flex:1;background:none;border:none;outline:none;
    color:var(--text);font-size:13.5px;font-family:inherit;padding:8px 0;
    min-width:0;
  }
  .input-row input::placeholder{color:var(--muted)}
  .send{
    width:36px;height:36px;border-radius:9px;border:none;cursor:pointer;
    background:var(--elevated);color:var(--muted);
    display:flex;align-items:center;justify-content:center;
    transition:all .2s;flex-shrink:0;
  }
  .send.on{background:var(--green);color:#fff;box-shadow:0 2px 10px rgba(63,185,80,.25)}
  .hint{text-align:center;margin-top:6px;font-size:10px;color:var(--muted)}

  /* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
  @keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
  @keyframes msgIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  @keyframes blink{0%,80%,100%{opacity:.3}40%{opacity:1}}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:.35}}

  @media(max-width:600px){
    .m{max-width:92%}
    .hdr{padding:10px 12px}
    .welcome h2{font-size:18px}
    .prompts{max-width:100%}
    .input-wrap{padding:8px 10px 12px}
    .msgs{padding:12px 10px}
  }
</style>
</head>
<body>
<div class="app">
  <div class="hdr">
    <div class="hdr-icon">üèÄ</div>
    <div><h1 id="appName">BracketGPT</h1><div class="sub" id="appTag">AI Bracket Advisor ¬∑ 2025 Tournament</div></div>
    <span class="live">LIVE</span>
  </div>

  <div class="msgs" id="msgs">
    <div class="msgs-spacer"></div>
    <div class="welcome" id="welcome">
      <div class="ico">üèÄ</div>
      <h2>Your bracket starts here.</h2>
      <p>Ask me about any matchup, upset picks, or bracket strategy. I've crunched 20 years of data so you don't have to.</p>
      <div class="prompts">
        <button onclick="go('Who wins Florida vs Houston?')">Florida vs Houston?</button>
        <button onclick="go('Best upset picks this year?')">Best upset picks?</button>
        <button onclick="go('Which 12-seed has the best shot?')">12-seed dark horse?</button>
        <button onclick="go('Compare the four 1-seeds for me')">Compare the 1-seeds</button>
        <button onclick="go('Build me a contrarian Final Four')">Contrarian Final Four</button>
        <button onclick="go('Big pool strategy ‚Äî what should I do?')">Big pool strategy</button>
      </div>
    </div>
    <div class="typing" id="typing">
      <div class="av" style="background:linear-gradient(135deg,var(--green),#238636)">üèÄ</div>
      <div class="dots"><span></span><span></span><span></span></div>
    </div>
    <div class="msgs-pad"></div>
  </div>

  <div class="input-wrap">
    <div class="input-row">
      <input type="text" id="inp" placeholder="Ask about any matchup‚Ä¶" autocomplete="off"
             onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();go()}">
      <button class="send" id="btn" onclick="go()">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
      </button>
    </div>
    <div class="hint">Powered by 3-model ensemble ¬∑ 76% historical accuracy</div>
  </div>
</div>

<script>
const $ = s => document.querySelector(s);
const msgs = $('#msgs');
const inp = $('#inp');
const btn = $('#btn');
const typing = $('#typing');
let hist = [], busy = false;

// Config
(async()=>{try{
  const r=await fetch('/api/config');
  if(r.ok){const c=await r.json();if(c.brandName){$('#appName').textContent=c.brandName;document.title=c.brandName}if(c.tagline)$('#appTag').textContent=c.tagline}
}catch(e){}})();

inp.addEventListener('input',()=>btn.classList.toggle('on',inp.value.trim().length>0));

function scroll(){msgs.scrollTop=msgs.scrollHeight}

function addMsg(who,text){
  const w=$('#welcome');if(w)w.remove();
  const d=document.createElement('div');
  d.className='m '+(who==='u'?'u':'b');
  const av=who==='u'?'üë§':'üèÄ';
  const body=who==='u'?esc(text):fmt(text);
  d.innerHTML=`<div class="av">${av}</div><div class="bd">${body}</div>`;
  msgs.insertBefore(d,typing);
  scroll();
  return d;
}

function fmt(t){
  // Handle markdown-style output from LLMs
  let s=t
    // bold
    .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
    // italic
    .replace(/\*(.*?)\*/g,'<em>$1</em>')
    // inline code
    .replace(/`([^`]+)`/g,'<code style="background:var(--elevated);padding:1px 5px;border-radius:4px;font-size:12px">$1</code>')
    // badges
    .replace(/\[LOCK\]/gi,'<span class="badge badge-lock">lock</span>')
    .replace(/\[CONFIDENT\]/gi,'<span class="badge badge-confident">confident</span>')
    .replace(/\[LEAN\]/gi,'<span class="badge badge-lean">lean</span>')
    .replace(/\[SLIGHT\]/gi,'<span class="badge badge-slight">slight</span>')
    .replace(/\[TOSS.?UP\]/gi,'<span class="badge badge-tossup">toss-up</span>');

  // Split into blocks by double newline
  const blocks=s.split(/\n{2,}/);
  let html='';
  for(const block of blocks){
    const trimmed=block.trim();
    if(!trimmed)continue;
    // Check if it's a list (lines starting with - or * or 1.)
    const lines=trimmed.split('\n');
    const isList=lines.every(l=>/^\s*[-*‚Ä¢]\s|^\s*\d+[.)]\s/.test(l)||!l.trim());
    if(isList&&lines.filter(l=>l.trim()).length>1){
      const items=lines.filter(l=>l.trim()).map(l=>l.replace(/^\s*[-*‚Ä¢]\s*/,'').replace(/^\s*\d+[.)]\s*/,''));
      html+='<ul>'+items.map(i=>'<li>'+i+'</li>').join('')+'</ul>';
    }else{
      // Handle single newlines as <br> within a paragraph
      html+='<p>'+trimmed.replace(/\n/g,'<br>')+'</p>';
    }
  }
  return html||'<p>'+s+'</p>';
}

function esc(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML}

async function go(text){
  const msg=text||inp.value.trim();
  if(!msg||busy)return;
  inp.value='';btn.classList.remove('on');
  busy=true;

  hist.push({role:'user',content:msg});
  addMsg('u',msg);

  typing.classList.add('on');scroll();

  try{
    const r=await fetch('/api/chat',{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({messages:hist})
    });
    const d=await r.json();
    typing.classList.remove('on');
    const reply=d.reply||d.error||'Something went wrong.';
    hist.push({role:'assistant',content:reply});
    addMsg('b',reply);
  }catch(e){
    typing.classList.remove('on');
    addMsg('b','Lost connection ‚Äî check your internet and try again.');
  }
  busy=false;
  inp.focus();
}
</script>
</body>
</html>
